<!DOCTYPE HTML>
<html><head>
<link rel="stylesheet" type="text/css" href="greetstyle.css" />
<title>GREET - API for developers</title>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40965405-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table border="0">
<tbody>
<tr><td>
<h1>GREET API for plugin developers</h1>
<p>GREET is now capable of loading plugin in order to extend functionalities. 
We are at the early stages of developing this API so we do appreciate any comments 
that may help us improving.</p>
<p>The <a href="modules.html">plugin page</a> shows 
examples of plugin that have been developed using the interface.</p>
<p>Documentation about the available methods and classes is <a href="api/html/index.html" target="_blank">available as HTML</a>
<p>The project containing the interfaces and some examples is available from <a href="https://github.com/greet-dev/GREETAPI/tree/master/2015" target="_blank">GitHub</a>
<p>
You can communicate with the GREET development team online on our <a href="http://webchat.freenode.net/?channels=greetlca" target="_blank">irc webchat</a>
</p>
<p>
<h3>Warning 2014:</h3>
The API has changed between GREET 2013 and GREET 2014, we are now providing more features and flexibilities but some of your code will need some refractoring in order to be used with GREET 2014.<br>
For a list of updates and modifications please see the <a href="api-modifs.html" target="_blank">API 2014 changes</a> page.
<h3>Minor 2015 changes:</h3>
The API has not drastically changed between 2014 and 2015, mostly functions have been added such as the DataHelper class which allows the user to create new processes, pathways... from the code easily.<br>
Please have a look at the code of the Example4 which is well documented and that uses the DataHelper class.
</p>
</td>
</tr>
<tr>
<td>
<h1>Getting started</h1>
<p>In order to familiarize yourself with the available methods and objects we created examples available from
the archive. Example1 lists all pathways and allows you to observe the total GHGs for a selected pathway.
Example2 allows the user to find a parameter and change the user value by the model, then allows to run another simulation.
</p>
<p>
Examples source code can be downloaded and tested by following these instructions:
</p>
<ul>
  <b>1)</b> Download and install GREET 2015 from our main page.
  <br><br><b>2)</b> After installation check that your My Documents folder contains the GREET DLLs, look into My Documents\Greet\Plugins\API\2015
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/myDocumentsDlls.png" width="400"></img>
  <br><br><b>3)</b> Check the references in the different projects, you must configure the references so they point to Greet.DataStructureV4, Greet.Model and Greet.UnitLib3 if you wish to use the current unit system
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/checkReferences.png" width="200"></img>
  <br><br><b>4)</b> We need to configure Visual Studio so that it runs GREET and automatically load the plug-ins in 
  debug mode. This allows you to debug your work using the Visual Studio IDE. 
  <br>In order to do so we'll need to configure the Debug and Post-Build actions for all projects under the solution.
  <br>First right click the Example1 project and select "Properties"
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/1-properties.png" height="400"></img>
  <br><br><b>5)</b> In the properties pane, select the "Debug" tab
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/2-debug.png" width="400"></img>
  <br> In the debug tab check "Start External Program" and point it to the greet executable: greet.exe. GREET is installed in a sub-folder of your personal folder, but the easiest way to find the exact location is by running GREET, 
  then click the "About" menu, then "About..." A new window will pop up, the installation location can be seen
  at the bottom.
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/about.png" width="400"></img>
  <br><br><b>6)</b> In the properties pane, select now the "Build Events" tab
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/3-build.png" width="400"></img>
  <br>In the "Post-build event command line" set visual studio to copy the output to your My Document folder.
  <br><br>copy "$(TargetPath)" "C:\Users\MY USERNAME\Documents\Greet\Plugins"
  <br> GREET checks if that folder contains plugins at startup. See more details in the following chapter about the plugins life cycle.
  <br><br><b>7)</b> Test your plugin by starting it in Debug mode:
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/4-run.png" width="400"></img>
  <br>When running in Debug mode you can put breakpoints in your code and easily follow the execution of the program for your
  plugin.
  <br>For this example you should see the menu item "Example1" created by the plugin.
  <br><img style="display: block;margin-left:auto;margin-right:auto;" src="pic/Example1-view.png" width="400"></img>
</ul>
</td>
</tr>
<tr>
<td>
<h1>Plugin Life Cycle</h1>
<p>
Plugins are loaded into GREET at startup before the data file is loaded and before the main interface is started. 
We are looking to load plugins from two different locations: The first location we're looking into is the folder in
which the greet.exe file is located. In this folder we are loading the modules provided by the GREET development team.
</p>
<p>
For user generate plugins it is preferable to copy them into the folder : <b>"My Documents\Greet\Plugins\"</b> that we also explore
in order to find libraries.
<br>The main advantage of using this location is that these plugins will be loaded regardless of the real location of the
executable. As GREET is released using ClickOnce, the real location of greet.exe is subject to change when there is an update.
</p>
<p>
<img style="display: block;margin-left:auto;margin-right:auto;" src="pic/lifecycle.png" width="300">
<br>After an instance of the plugin class is created, the first call to a plugin is InitializePlugin. This call offers to the developer
an instance to the controller class that can be used for the plugin. The controler class is very important and provides access to
the loaded database and to commands such as RunSimulations().</p>
<p>
After that the plugin will receive multiple calls: when a data file is loaded the onDatabaseLoaded() method is called,
when the main user interface of GREET is loaded, the plugin calls will be GetMainButton() and GetMainMenuItems(). You can
override these methods to provide the main user interface with a list of Buttons or ToolStripMenuItems that will be loaded
into the main window of GREET. There are many calls that can be used and we suggest you to look in the APlugin class for an
exhaustive list of all the existing methods.</p>
<p>
 Finally when the user chooses to close GREET, the plugin is called twice. The first call is onMainFormClosing() at this point
we are starting to close the software, but we haven't checked for database changed yet. It is then a good time for your plugin to
push data changes before a message asks the user to save or not his changes. The last call is onFinalizePlugin() at this point all
resources are unallocated and GREET execution is about to be terminated.
</p>
</td>
</tr>
</tbody>
</table>

</body></html>